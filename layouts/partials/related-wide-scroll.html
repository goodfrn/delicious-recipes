{{/* layouts/partials/related-wide-scroll.html */}}

{{ $config := .Site.Data.config }}
{{ $recipe_page := $config.recipe_page }}

{{/* Catégorie principale */}}
{{ $cat := "" }}
{{ with index .Params.categories 0 }}{{ $cat = . }}{{ end }}

{{/* Récupère des recettes de la même catégorie */}}
{{ $all := where .Site.RegularPages "Section" "recipes" }}
{{ $items := slice }}

{{ range $all }}
  {{ if and (ne .RelPermalink $.RelPermalink) (in (.Params.categories | default (slice)) $cat) }}
    {{ $items = $items | append . }}
  {{ end }}
{{ end }}

{{ $items = first 10 $items }}

{{ if gt (len $items) 0 }}
<section class="mt-12 w-full max-w-full overflow-hidden">

  <!-- Header -->
  <div class="flex items-center justify-between mb-5">
    <h2 class="text-lg md:text-xl font-medium"
        style="color: var(--color-text); font-family: var(--font-serif);">
      You’ll Also Love
      {{ if $cat }}<span class="opacity-60"> · {{ $cat }}</span>{{ end }}
    </h2>

    <a href="/recipes/" class="text-sm font-medium hover:underline"
       style="color: var(--primary);">
      Explore all →
    </a>
  </div>

    <!-- Scroll HORIZONTAL MAIS CLIPPÉ -->
  <div class="w-full max-w-full overflow-hidden">
    <div
      class="related-rail flex gap-4 overflow-x-auto pb-4 snap-x snap-mandatory scroll-smooth cursor-grab active:cursor-grabbing select-none"
      style="-webkit-overflow-scrolling: touch;"
      data-related-rail
      data-related-interval="2500"
    >
      {{ range $items }}
        <a href="{{ .RelPermalink }}"
           class="snap-start flex-shrink-0 w-[85%] sm:w-[55%] lg:w-[33%] group"
           data-related-item>

          <article class="rounded-2xl overflow-hidden border border-gray-100 bg-white hover:shadow-sm transition">
            {{ with .Params.image }}
              <div class="aspect-[16/10] overflow-hidden">
                {{ partial "recipe-image.html" (dict "image" . "title" $.Title) }}
              </div>
            {{ end }}

            <div class="p-4">
              <h3 class="text-base font-medium leading-snug line-clamp-2"
                  style="color: var(--color-text); font-family: var(--font-serif);">
                {{ .Title }}
              </h3>
            </div>
          </article>

        </a>
      {{ end }}
    </div>
  </div>
</section>
{{ end }}
