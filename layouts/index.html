{{ define "main" }}

{{ $config := .Site.Data.config }}
{{ $homepage := $config.homepage }}

<!-- Hero animÃ© (conservÃ© tel quel car spÃ©cifique) -->
{{ partial "hero.html" . }}

<!-- SECTION MIGRÃ‰E : DerniÃ¨res recettes avec style premium -->
<section class="section" style="background: linear-gradient(180deg, var(--color-bg) 0%, #faf9f7 100%);">
  <div class="container">
    
    <!-- ðŸ·ï¸ Titre avec classe section__title centrÃ© -->
    <div class="text-center mb-12">
      <h2 class="section__title text-center">
        {{ $homepage.latest_recipes.title }}
      </h2>
      
      <!-- Description avec typographie premium -->
      <p class="text-base text-center max-w-2xl mx-auto mt-4 leading-relaxed" 
         style="color: var(--color-text-secondary); font-family: var(--font-serif);">
        {{ $homepage.latest_recipes.description }}
      </p>
    </div>

    <!-- Grille recettes avec CARTES ULTRA-PREMIUM -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
      {{ range first 6 (where .Site.RegularPages "Section" "recipes") }}
        
        <!-- ðŸ† CARTE ULTRA-PREMIUM STYLÃ‰E - ENTIÃˆREMENT CLIQUABLE -->
        <a href="{{ .RelPermalink }}" class="group block bg-white/80 backdrop-blur-sm overflow-hidden hover:shadow-2xl hover:scale-[1.02] transition-all duration-500 rounded-2xl border border-gray-200/50">
          
<!-- Image optimisÃ©e avec overlay premium -->
          <div class="relative overflow-hidden aspect-[4/3]">
            {{ with .Params.image }}
              <div class="group-hover:scale-110 transition-transform duration-700">
                {{ partial "recipe-image.html" (dict "image" . "title" $.Title) }}
              </div>
            {{ end }}
            
            <!-- Overlay gradient subtil -->
            <div class="absolute inset-0 bg-gradient-to-t from-black/10 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
            
            <!-- Badge catÃ©gorie premium -->
            {{ with index .Params.categories 0 }}
              <div class="absolute top-4 left-4 px-3 py-2 bg-white/95 backdrop-blur-sm rounded-xl shadow-lg border border-gray-200/50">
                <span class="text-xs font-bold tracking-wider uppercase" 
                      style="color: var(--primary); font-family: var(--font-sans);">
                  {{ . }}
                </span>
              </div>
            {{ end }}
          </div>
          
          <!-- Contenu ultra-premium -->
          <div class="p-7 space-y-5">
            
            <!-- Titre sophistiquÃ© -->
            <h3 class="font-serif text-xl leading-tight font-medium hover:opacity-75 transition-opacity duration-200" 
                style="color: var(--color-text); font-family: var(--font-serif);">
              {{ .Title }}
            </h3>
            
            <!-- MÃ©triques ultra-sophistiquÃ©es -->
            <div class="flex items-center justify-between pt-3 border-t border-gray-100/60">
              
              <!-- Temps avec icÃ´ne premium -->
              {{ with .Params.totalTime }}
                <div class="flex items-center space-x-2">
                  <div class="w-5 h-5 rounded-full flex items-center justify-center" 
                       style="background: linear-gradient(45deg, var(--primary), var(--secondary));">
                    <div class="w-2 h-2 rounded-full bg-white"></div>
                  </div>
                  <span class="text-sm font-semibold text-gray-700">
                    {{ . | replaceRE "^PT(\\d+)M$" "$1 min" | replaceRE "^PT(\\d+)H$" "$1h" | replaceRE "^PT(\\d+)H(\\d+)M$" "$1h $2min" }}
                  </span>
                </div>
              {{ end }}
              
              <!-- Portions avec icÃ´ne premium -->
              {{ with .Params.recipeYield }}
                <div class="flex items-center space-x-2">
                  <div class="w-5 h-5 rounded-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
                    <div class="w-2 h-2 rounded-full bg-gray-600"></div>
                  </div>
                  <span class="text-sm font-semibold text-gray-700">
                    {{ . }}
                  </span>
                </div>
              {{ end }}
              
              <!-- Calories avec icÃ´ne premium -->
              {{ with .Params.nutrition.calories }}
                <div class="flex items-center space-x-2">
                  <div class="w-5 h-5 rounded-full flex items-center justify-center bg-gradient-to-br from-orange-100 to-orange-200">
                    <div class="w-2 h-2 rounded-full bg-orange-600"></div>
                  </div>
                  <span class="text-sm font-semibold text-gray-700">
                    {{ . }} cal
                  </span>
                </div>
              {{ end }}
            </div>
            
            <!-- Tags ultra-premium -->
            {{ if .Params.tags }}
              <div class="flex flex-wrap gap-2 pt-4">
                {{ range first 3 .Params.tags }}
                  <span class="px-3 py-1.5 bg-gradient-to-r from-gray-50 to-gray-100 rounded-full border border-gray-200/50 hover:shadow-sm transition-shadow duration-200">
                    <span class="text-xs font-medium text-gray-600">{{ . }}</span>
                  </span>
                {{ end }}
              </div>
            {{ end }}
            
            <!-- Footer editorial avec sÃ©parateur -->
            <div class="flex items-center justify-between pt-5 border-t border-gray-100/60">
              <time class="text-xs text-gray-400 font-medium tracking-wider" datetime="{{ .Date.Format "2006-01-02" }}">
                {{ .Date.Format "Jan 2, 2006" }}
              </time>
              <div class="flex items-center gap-2">
                <span class="w-1 h-1 rounded-full bg-gray-300"></span>
                <span class="text-xs text-gray-400 font-medium">Recipe</span>
              </div>
            </div>
          </div>
          
        </a>

      {{ end }}
    </div>
  </div>
</section>

<!-- SECTION MIGRÃ‰E : Recettes populaires avec style premium -->
<section class="section" style="background: linear-gradient(180deg, #faf9f7 0%, var(--color-bg) 100%);">
  <div class="container">
    
    <!-- ðŸ·ï¸ Titre avec classe section__title centrÃ© -->
    <div class="text-center mb-12">
      <h2 class="section__title text-center">
        {{ $homepage.popular_recipes.title }}
      </h2>
    </div>
    
<!-- Grille recettes avec CARTES ULTRA-PREMIUM -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
      {{ $all := where .Site.RegularPages "Section" "recipes" }}
      {{ $count := len $all }}
      {{ if gt $count 0 }}
        {{ $week := div now.Unix 604800 }}
        {{ $offset := mod $week $count }}
        {{ $limit := 6 }}
        {{ if lt $count 6 }}{{ $limit = $count }}{{ end }}
        {{ range $i := seq 0 (sub $limit 1) }}
          {{ $idx := mod (add $offset $i) $count }}
          {{ $item := index $all $idx }}
          
          <!-- ðŸ† CARTE ULTRA-PREMIUM STYLÃ‰E - ENTIÃˆREMENT CLIQUABLE -->
          <a href="{{ $item.RelPermalink }}" class="group block bg-white/80 backdrop-blur-sm overflow-hidden hover:shadow-2xl hover:scale-[1.02] transition-all duration-500 rounded-2xl border border-gray-200/50">
            
<!-- Image optimisÃ©e avec overlay premium -->
            <div class="relative overflow-hidden aspect-[4/3]">
              {{ with $item.Params.image }}
                <div class="group-hover:scale-110 transition-transform duration-700">
                  {{ partial "recipe-image.html" (dict "image" . "title" $item.Title) }}
                </div>
              {{ end }}
              
              <!-- Overlay gradient subtil -->
              <div class="absolute inset-0 bg-gradient-to-t from-black/10 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
              
              <!-- Badge catÃ©gorie premium -->
              {{ with index $item.Params.categories 0 }}
                <div class="absolute top-4 left-4 px-3 py-2 bg-white/95 backdrop-blur-sm rounded-xl shadow-lg border border-gray-200/50">
                  <span class="text-xs font-bold tracking-wider uppercase" 
                        style="color: var(--primary); font-family: var(--font-sans);">
                    {{ . }}
                  </span>
                </div>
              {{ end }}
            </div>
            
            <!-- Contenu ultra-premium -->
            <div class="p-7 space-y-5">
              
              <!-- Titre sophistiquÃ© -->
              <h3 class="font-serif text-xl leading-tight font-medium hover:opacity-75 transition-opacity duration-200" 
                  style="color: var(--color-text); font-family: var(--font-serif);">
                {{ $item.Title }}
              </h3>
              
              <!-- MÃ©triques ultra-sophistiquÃ©es -->
              <div class="flex items-center justify-between pt-3 border-t border-gray-100/60">
                
                <!-- Temps avec icÃ´ne premium -->
                {{ with $item.Params.totalTime }}
                  <div class="flex items-center space-x-2">
                    <div class="w-5 h-5 rounded-full flex items-center justify-center" 
                         style="background: linear-gradient(45deg, var(--primary), var(--secondary));">
                      <div class="w-2 h-2 rounded-full bg-white"></div>
                    </div>
                    <span class="text-sm font-semibold text-gray-700">
                      {{ . | replaceRE "^PT(\\d+)M$" "$1 min" | replaceRE "^PT(\\d+)H$" "$1h" | replaceRE "^PT(\\d+)H(\\d+)M$" "$1h $2min" }}
                    </span>
                  </div>
                {{ end }}
                
                <!-- Portions avec icÃ´ne premium -->
                {{ with $item.Params.recipeYield }}
                  <div class="flex items-center space-x-2">
                    <div class="w-5 h-5 rounded-full flex items-center justify-center bg-gradient-to-br from-gray-100 to-gray-200">
                      <div class="w-2 h-2 rounded-full bg-gray-600"></div>
                    </div>
                    <span class="text-sm font-semibold text-gray-700">
                      {{ . }}
                    </span>
                  </div>
                {{ end }}
                
                <!-- Calories avec icÃ´ne premium -->
                {{ with $item.Params.nutrition.calories }}
                  <div class="flex items-center space-x-2">
                    <div class="w-5 h-5 rounded-full flex items-center justify-center bg-gradient-to-br from-orange-100 to-orange-200">
                      <div class="w-2 h-2 rounded-full bg-orange-600"></div>
                    </div>
                    <span class="text-sm font-semibold text-gray-700">
                      {{ . }} cal
                    </span>
                  </div>
                {{ end }}
              </div>
              
              <!-- Tags ultra-premium -->
              {{ if $item.Params.tags }}
                <div class="flex flex-wrap gap-2 pt-4">
                  {{ range first 3 $item.Params.tags }}
                    <span class="px-3 py-1.5 bg-gradient-to-r from-gray-50 to-gray-100 rounded-full border border-gray-200/50 hover:shadow-sm transition-shadow duration-200">
                      <span class="text-xs font-medium text-gray-600">{{ . }}</span>
                    </span>
                  {{ end }}
                </div>
              {{ end }}
              
              <!-- Footer editorial avec sÃ©parateur -->
              <div class="flex items-center justify-between pt-5 border-t border-gray-100/60">
                <time class="text-xs text-gray-400 font-medium tracking-wider" datetime="{{ $item.Date.Format "2006-01-02" }}">
                  {{ $item.Date.Format "Jan 2, 2006" }}
                </time>
                <div class="flex items-center gap-2">
                  <span class="w-1 h-1 rounded-full bg-gray-300"></span>
                  <span class="text-xs text-gray-400 font-medium">Recipe</span>
                </div>
              </div>
            </div>
            
          </a>
        {{ end }}
      {{ else }}
        <p class="text-center col-span-full py-12" style="color: var(--color-text-secondary);">
          {{ $homepage.popular_recipes.empty_message }}
        </p>
      {{ end }}
    </div>
  </div>
</section>

<!-- SECTION MIGRÃ‰E : Explorer par catÃ©gorie avec style premium -->
<section class="section" style="background: linear-gradient(135deg, var(--color-bg) 0%, #faf9f7 50%, var(--color-bg) 100%);">
  <div class="container">
    
    <!-- ðŸ·ï¸ Titre avec classe section__title centrÃ© -->
    <div class="text-center mb-12">
      <h2 class="section__title text-center">
        {{ $homepage.categories_section.title }}
      </h2>
    </div>
    
    <!-- Grille catÃ©gories avec CARDS ULTRA-PREMIUM -->
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 gap-6 justify-center">
      {{ range sort .Site.Taxonomies.categories "Count" "desc" }}
        {{/* ðŸŽ¯ LOGIQUE IDENTIQUE aux autres templates */}}
        {{ $slug := .Page.Title | lower | urlize }}
        {{ $displayName := .Page.Title }}
        
        {{/* Chercher dans la config s'il y a un nom personnalisÃ© */}}
        {{ $config := $.Site.Data.config }}
        {{ range $config.categories_system.categories_config.categories_list }}
          {{ if eq .slug $slug }}
            {{ $displayName = .name }}
          {{ end }}
        {{ end }}
        
        <a href="{{ .Page.RelPermalink }}" 
           class="group bg-white/70 backdrop-blur-sm border border-gray-200/50 rounded-2xl p-6 flex items-center justify-center text-center hover:shadow-xl hover:scale-105 transform transition-all duration-300 min-h-[120px]">
          <div class="space-y-2">
            <div class="w-3 h-3 rounded-full mx-auto opacity-60 group-hover:opacity-100 transition-opacity duration-200" 
                 style="background: linear-gradient(45deg, var(--primary), var(--secondary));"></div>
            <span class="text-base font-semibold tracking-wide block" 
                  style="color: var(--color-text); font-family: var(--font-serif);">
              {{ $displayName }}
            </span>
          </div>
        </a>
      {{ end }}
    </div>
  </div>
</section>

<!-- SECTION MIGRÃ‰E : Newsletter avec style premium -->
<section class="section" style="background: linear-gradient(135deg, #faf9f7 0%, var(--color-bg) 100%);">
  <div class="container">
    
    <!-- ðŸ·ï¸ Titre avec classe section__title centrÃ© -->
    <div class="text-center mb-12">
      <h2 class="section__title text-center">
        {{ $homepage.newsletter.title }}
      </h2>
      
      <!-- Description avec typographie premium -->
      <p class="text-center max-w-xl mx-auto mt-4 text-base leading-relaxed" 
         style="color: var(--color-text-secondary); font-family: var(--font-serif);">
        {{ $homepage.newsletter.description }}
      </p>
    </div>
    
    <!-- Formulaire newsletter ultra-premium -->
    <div class="max-w-lg mx-auto">
      <form action="{{ $homepage.newsletter.form_action }}" method="POST" 
            class="bg-white/80 backdrop-blur-sm border border-gray-200/50 rounded-2xl p-8 shadow-xl">
        <div class="flex flex-col sm:flex-row sm:items-center gap-4">
          <label for="newsletter-email" class="sr-only">Email Address</label>
          <input id="newsletter-email" 
                 type="email" 
                 name="email" 
                 required 
                 placeholder="{{ $homepage.newsletter.email_placeholder }}" 
                 class="w-full sm:flex-grow px-4 py-3 border rounded-xl focus:outline-none focus:ring-2 focus:border-transparent transition-all duration-200" 
                 style="border-color: var(--color-text-muted); color: var(--color-text); focus:ring-color: var(--primary);">
          
          <!-- BOUTON NEWSLETTER SIMPLE -->
          <button type="submit" class="btn btn--primary btn--lg">
            {{ $homepage.newsletter.button_text }}
          </button>
        </div>
      </form>
    </div>
  </div>
</section>

{{ end }}
